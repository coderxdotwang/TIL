# 2020-06-27 Swift 中结构体 struct 与类 class 异同

## 1、相同点

语法非常相似，几乎完全一样：都可以有存储变量 **stored vars** 和计算变量 **computed vars**，以及常量 **constant lets**，都可以定义方法 **functions**，也都有初始化方法 **initializers**。

## 2、不同点

最大的不同点是结构体是值类型，类是引用类型。引用类型通过指针 **pointers** 传递，存储在堆中，传递时是指向内存中同一个对象；结构体则传递的是拷贝。

结构体是支持函数式编程的基础；类是为面向对象编程而设计。函数式编程关注事务的功能；面向对象关注的是将数据和功能封装到一个容器中，即类，类存储在堆中，总是可变（这也是类带来的问题，只要有指针就可以修改）。我们应该优先考虑使用结构体，只在特定情况下使用类，例如 MVVM 中的视图模型。

|           结构体 struct           |                 类 class                 |
| :-------------------------------: | :--------------------------------------: |
|         值类型 Value type         |         引用类型 Reference type          |
|  赋值或传递时会被复制 **copied**  |        通过指针 **pointers** 传递        |
|      写时复制 copy on write       |               自动引用计数               |
| 函数式编程 Functional programming | 面向对象编程 Object-oriented programming |
|            不支持继承             |                 单重继承                 |
|  自动生成的构造器初始化所有变量   |      自动生成的构造器不会初始化变量      |
|        必须明确声明可变性         |                总是可变的                |



## 3、如何在类与结构体之间选择？

>建议 1：默认使用**结构体**
>
>建议2：需要与 Objective-C 交互时使用类
>
>建议 3：需要控制所建模数据 Identiity 时使用类
>
>建议 4：使用结构体和协议，通过共享实现来采用行为

#### 3.1 建议 1：默认使用结构体

Swift 中的结构体包含许多其他语言中类才有的特性：结构体可以包含存储属性、计算属性及方法。Swift 中的结构体也可以遵循协议来获得默认实现中的行为。Swift 标准库及 Foundation 中的 *数字（Number）*、*字符串（String）*、*数组（Array）*、*字典（Dictionary）*、*布尔值（Bool）*等都是结构体。

结构体是值类型，因此结构体的局部调整对应用其他部分透明，除非你有意作为应用流程的一部分来交流那些改变。

#### 3.2 建议 2：需要与 Objective-C 交互时使用类

需要访问 Objective-C API 处理数据，或者数据模型需要整合进 Objective-C 框架中已存在的类层次结构。例如，许多 Objective-C 框架暴露了期望子类化的类。

#### 3.3 建议 3：需要控制 Identity 时使用类

由于类是引用类型，所以 Swift 中的类自带 Identity 概念。这意味着，当两个不同类实例的存储属性拥有相同值时，通过 恒等运算符（===）他们仍然被认为是不同的。也意味着在应用中传递类实例时（**不鼓励这样做，更容易带来问题**），所有对实例的改变对其他拥有该实例引用的对象都可见。常见场景如文件处理、网络连接、数据库访问管理等。

当你为数据建模时，如果数据包含一个不需要控制 ID 的实体有关信息，可以使用结构体（示例：PenPalRecord，包含一个常量属性 ID 的结构体）。

#### 3.4 建议 4：使用结构体和协议实现模型继承及行为共享

结构体和类都支持某种继承形式。结构体和协议只能采用协议方式，它们不能继承类。使用类构建的继承层次结构也可以使用协议继承和结构体建模。

协议允许类、结构体、枚举参与继承，而类继承只兼容其他类。当选择如何为数据建模时，首先尝试使用协议继承来构建数据类型的层级结构，然后在结构体中采用这些协议。

### 参考：

-----

1. [Stanford CS193P 2020 Lecture 2](https://www.bilibili.com/video/BV1HK4y1t7KG?p=2
2. [Choosing Between Structures and Classes](https://developer.apple.com/documentation/swift/choosing_between_structures_and_classes)

